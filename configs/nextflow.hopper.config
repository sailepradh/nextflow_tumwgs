// indentation is 2 spaces

singularity{
  enabled                             = true	
  runOptions                          = "--bind /fs1/ --bind /local/ --bind /fs2/ --bind /mnt/beegfs/"
}

env{
  SENTIEON_LICENSE                    = "10.139.0.101:8990"
  bwt_max_mem                         = "50G"
}

trace {
  enabled                             = true
  overwrite                           = true
}

report {
  enabled                             = true
  overwrite                           = true
}

timeline {
  enabled                             = true
  overwrite                           = true
}

params {

   // CPU counts //
  cpu_all                             = 50
  cpu_many                            = 16
  cpu_some                            = 8

  queue                               = "grace-normal"
  git                                 = "$baseDir/git.hash"
  container_dir                       = "/fs1/resources/containers"
  container                           = "${params.container_dir}/tumwgs_2022-02-08.sif"

  // results dir //
  resultsdir                          = "/fs1/results"
  dev                                 = false
  dev_suffix                          = ""
  if (params.dev) {
    dev_suffix                        = "_dev"
  }

  // DEFAULTS PATHS //
  refpath                             = "/fs1/resources/ref/hg38/"
  outdir                              = "${params.resultsdir}${params.dev_suffix}"
  subdir                              = "tumwgs"
  crondir                             = "${params.outdir}/cron/"
  gens_accessdir                      = "/access/wgs/plot_data"
  noupload                            = false
  copy                                = true


  // SENTIEON ALIGNMENT CONFIGS //
  shardbwa                            = true
  genomic_shards_file                 = "$baseDir/resources/shards_400MB.csv"
  genomic_shards_num                  = 9
  bwa_shards                          = 8
  regions_bed                         = "${refpath}/bed/wgsexome/hg38_ens98_allcodingexons20bppadding_allclinvar5bppadding_agilent.noalt.bed"
  K_size                              = 100000000


  // FASTA //
  genome_file                         = "${refpath}/fasta/GCA_000001405.15_GRCh38_no_alt_analysis_set_nochr.fna"
  GENOMEDICT                          = "${refpath}/fasta/GCA_000001405.15_GRCh38_no_alt_analysis_set_nochr.dict"
  sample_val                          = 50000000 // needs to be changed
  sample                              = true
  trimfq                              = 
  
  // ANNOTATION DBS GENERAL //
  known                               = "${refpath}/annotation_dbs/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz"
  dbSnp                               = "${refpath}/annotation_dbs/dbsnp_146.hg38.vcf.gz"

  
  // SNV-CALLING //
  pindel                              = true
  melt                                = true
  
  freebayes                           = true
  PON_freebayes                       = "${refpath}/tumwgs/PON_freebayes_206_wgs"
  
  vardict                             = true
  PON_vardict                         = "${refpath}/tumwgs/PON_vardict_206_wgs"
  


  // SNV CALLING //
  vardict_var_freq_cutoff_p           = '0.03'
  vardict_var_freq_cutoff_up          = '0.03'
  fb_var_freq_cutoff_p                = '0.03'
  fb_var_freq_cutoff_up               = '0.03'
  tnscope                             = false
  //tnscope_var_freq_cutoff_p           = '0.05'
  //tnscope_var_freq_cutoff_up          = '0.05'


  // VEP REFERENCES AND ANNOTATION DBS //
  vepcon                              = "${params.container_dir}/ensembl-vep_release_103.sif"
  CADD                                = "${params.refpath}/annotation_dbs/whole_genome_SNVs.tsv.gz"
  VEP_FASTA                           = "${params.refpath}/vep/.vep/homo_sapiens_merged/98_GRCh38/Homo_sapiens.GRCh38.dna.toplevel.fa.gz"
  MAXENTSCAN                          = "${params.refpath}/vep/.vep/Plugins/MaxEntScan_scripts"
  VEP_CACHE                           = "${params.refpath}/vep/.vep103"
  GNOMAD                              = "${params.refpath}/annotation_dbs/gnomad_3.1/gnomad.genomes.v3.1.sites.mini.vcf.gz"
  COSMIC                              = "${params.refpath}/annotation_dbs/CosmicCodingMuts_v92.vcf.gz"
  gene_regions                        = "${params.refpath}/gtf/gencode.v33.exons.sort.merge.bed"
  gencode_genes                       = "${params.refpath}/gtf/gencode.v33.annotation.genes.proteincoding.bed"
  GATK_GNOMAD                         = "${params.refpath}/gatk_cnv/gnomad_5pct.intervals"
  refflat                             = "${params.refpath}/annotation_dbs/refFlat_nochr.txt"
  blacklist                           = "/fs1/viktor/gatk_ref/patched_hg38/resources/hg38-blacklist.v2.nochr.bed"
  priors                              = "/fs1/viktor/gatk_ref/patched_hg38/resources/priors"
  gene_gtf                            = "${params.refpath}/gtf/gencode.v33.annotation.genes.proteincoding.bed"

  // GATK CNV Calling parameters //
  gatk_cnv                            = true
  GATK_intervals_full                 = "${refpath}/gatk_cnv/targets_preprocessed_100bp_bins.interval_list"
  GATK_PON_FEMALE                     = "${refpath}/gatk_cnv/20200204_female_cnvpon_100bp.hdf5"
  GATK_PON_MALE                       = "${refpath}/gatk_cnv/20200204_male_cnvpon_100bp.hdf5"
  GATK_ploidymodel                    = "${refpath}/gatk_cnv/cnvref/ploidy-model"
  GATK_gatkreffolders                 = "${refpath}/gatk_cnv/cnvref/gatk_ref"
  GENE_BED_PC                         = "${refpath}/gtf/gencode.v33.annotation.genes.proteincoding.bed"

  // sv
  manta                               = true

}

profiles {
  hema {
    
    params.SNV_HARD_FILTER            = false
    params.PANEL_SNV                  = "${params.refpath}/tumwgs/snv.panel.AL"
    params.PANEL_CNV                  = "${params.refpath}/tumwgs/cna.panel.AL"
    params.PANEL_FUS                  = "${params.refpath}/tumwgs/fusion.panel.AL"

  }

  solid {
    
    params.SNV_HARD_FILTER            = false
    params.PANEL_SNV                  = "${params.refpath}/tumwgs/snv.panel"
    params.PANEL_CNV                  = "${params.refpath}/tumwgs/cna.panel"
    params.PANEL_FUS                  = "${params.refpath}/tumwgs/fusion.panel"

  } 

}

manifest {
    name                              = "Somatic Whole Genome Sequencing Pipeleine"
    author                            = "CMD Lund"
    homePage                          = "https://github.com/Clinical-Genomics-Lund/nextflow_tumwgs"
    description                       = "Call and annotate variants from WGS/WES of cancer patients"
    mainScript                        = "main.nf"
    nextflowVersion                   = "!>=21.10.3"
    version                           = "3.0.0"
}

// Include necessary configs
includeConfig "configs/modules/base.config"
includeConfig "configs/nextflow.process.config"

// Module specifc configs
includeConfig "configs/modules/create_meta.config"
includeConfig "configs/modules/sample.config"
includeConfig "configs/modules/software_versions.config"
includeConfig "configs/modules/align_sentieon.config"
includeConfig "configs/modules/snv_calling.config"
includeConfig "configs/modules/snv_annotate.config"
includeConfig 'configs/modules/cnv_calling.config'
includeConfig 'configs/modules/sv_calling.config'

process {
  executor                            = "slurm"
  queue                               = params.queue
  time                                = 48.h
  container                           = params.container
}
